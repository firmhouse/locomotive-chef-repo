<%= @custom_configuration["before_server"] %>

server {
  listen <%= node['nginx']['port'] || '80' %>;
  server_name <%= @domain_names.join(' ') %>;
  root <%= node['rails']['applications_root'] %>/<%= @name %>/current/public;

  passenger_enabled on;
  passenger_app_env <%= @rails_env %>;
  <%= @custom_configuration["server_main"] %>
}

<% if @ssl_enabled %>

server {
  listen 443 ssl;

  ssl_certificate     <%= @ssl_certificate %>;
  ssl_certificate_key <%= @ssl_certificate_key %>;

  passenger_enabled on;
  passenger_app_env <%= @rails_env %>;

  server_name <%= @domain_names.join(' ') %>;

  root <%= node['rails']['applications_root'] %>/<%= @name %>/current/public;
  <%= @custom_configuration["ssl_main"] %>
}

<% end %>

<%= @custom_configuration["after_server"] %>
